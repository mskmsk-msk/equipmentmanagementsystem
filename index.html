<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„í’ˆê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }

        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 3px solid #34495e;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .header h1 {
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .header p {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .data-management-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            padding: 20px;
            margin-top: 20px;
            align-items: start;
        }

        .data-management-2col h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .backup-btns {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-adder {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .category-adder input {
            flex: 1;
            padding: 8px;
            border: 2px solid #bdc3c7;
            font-size: 0.9rem;
        }

        .company-info {
            background: white;
            border: 2px solid #34495e;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
            justify-content: end;
        }

        .company-info div {
            padding: 5px;
        }

        .company-info strong {
            color: #2c3e50;
        }

        .section {
            background: white;
            margin: 20px 0;
            border: 2px solid #34495e;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }

        .section-header {
            background-color: #34495e;
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2c3e50;
        }

        .section-header h2 {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .section-content {
            padding: 20px;
        }

        .btn {
            background-color: #34495e;
            color: white;
            border: 1px solid #2c3e50;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #2c3e50;
        }

        .btn-success {
            background-color: #27ae60;
            border-color: #229954;
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .btn-danger {
            background-color: #e74c3c;
            border-color: #c0392b;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.8rem;
        }

        .btn-um {
            font-size: 0.75rem;
            padding: 3px 6px;
            line-height: 1.2;
            min-width: auto;
            height: auto;
            border-radius: 4px;
        }

        .backup-btns-um {
            gap: 6px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px;
            border: 2px solid #bdc3c7;
            font-size: 0.9rem;
            background-color: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        .search-filter {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
        }

        .search-filter input,
        .search-filter select {
            padding: 8px;
            border: 2px solid #bdc3c7;
            font-size: 0.9rem;
        }

        .table-container {
            border: 2px solid #34495e;
            overflow-x: auto;
            background: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
            font-size: 0.8rem;
        }

        th {
            background-color: #95a5a6;
            color: #2c3e50;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #7f8c8d;
            font-size: 0.8rem;
        }

        td {
            padding: 10px 8px;
            border: 1px solid #bdc3c7;
            text-align: center;
            font-size: 0.8rem;
            background-color: white;
        }

        tr:nth-child(even) td {
            background-color: #f8f9fa;
        }

        tr:hover td {
            background-color: #e8f4fd;
        }

        .status-good { 
            background-color: #d5f4e6 !important;
            color: #27ae60;
            font-weight: bold;
            border: 1px solid #27ae60;
            padding: 3px 6px;
        }

        .status-fair { 
            background-color: #fff3cd !important;
            color: #f39c12;
            font-weight: bold;
            border: 1px solid #f39c12;
            padding: 3px 6px;
        }

        .status-poor { 
            background-color: #fadbd8 !important;
            color: #e74c3c;
            font-weight: bold;
            border: 1px solid #e74c3c;
            padding: 3px 6px;
        }

        .action-btns {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 3% auto;
            border: 3px solid #34495e;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            background-color: #34495e;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .close {
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .close:hover {
            color: #bdc3c7;
        }

        .modal-body {
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border: 2px solid #34495e;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            display: block;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }

        .backup-section {
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            padding: 15px;
            margin-top: 20px;
        }

        .backup-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .backup-btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .search-filter {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            th, td {
                padding: 6px 4px;
                font-size: 0.7rem;
            }
            
            .company-info {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body { background-color: white; }
            .section { border: 1px solid #000; }
            .btn, .modal, .backup-section { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ë¹„ í’ˆ ê´€ ë¦¬ ì‹œ ìŠ¤ í…œ</h1>
        <p>EQUIPMENT MANAGEMENT SYSTEM</p>
    </div>

    <div class="container">
        <!-- íšŒì‚¬ ì •ë³´ -->
        <div class="company-info">
            <div><strong>íšŒì‚¬ëª…:</strong> <span id="companyName">ì‹œì ì—”ì§€ë‹ˆì–´ë§</span></div>
            <div><strong>ë‹´ë‹¹ì:</strong> <span id="manager">ê´€ë¦¬íŒ€ ì—¼ìš°ì„ </span></div>
        </div>

        <!-- í†µê³„ -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalEquipment">0</span>
                <div class="stat-label">ì´ ë¹„í’ˆ ìˆ˜</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="goodCondition">0</span>
                <div class="stat-label">ì •ìƒ ë¹„í’ˆ</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="needMaintenance">0</span>
                <div class="stat-label">ì ê²€ í•„ìš”</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalValue">0</span>
                <div class="stat-label">ì´ ìì‚°ê°€ì¹˜ (ë§Œì›)</div>
            </div>
        </div>

        <!-- ë¹„í’ˆ ê´€ë¦¬ -->
        <div class="section">
            <div class="section-header">
                <h2>â–  ë¹„í’ˆ í˜„í™© ê´€ë¦¬</h2>
                <button class="btn btn-success" onclick="openModal('equipmentModal')">
                    ï¼‹ ìƒˆ ë¹„í’ˆ ë“±ë¡
                </button>
            </div>
            <div class="section-content">
                <!-- ê²€ìƒ‰ ë° í•„í„° -->
                <div class="search-filter">
                    <input type="text" id="searchInput" placeholder="ë¹„í’ˆëª…, ëª¨ë¸ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="filterEquipment()">
                    <select id="categoryFilter" onchange="filterEquipment()">
                        <option value="">ì „ì²´ ë¶„ë¥˜</option>
                        <option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
                        <option value="ì‚¬ë¬´ê¸°ê¸°">ì‚¬ë¬´ê¸°ê¸°</option>
                        <option value="ê°€êµ¬">ê°€êµ¬</option>
                        <option value="ì†Œëª¨í’ˆ">ì†Œëª¨í’ˆ</option>
                    </select>
                    <select id="statusFilter" onchange="filterEquipment()">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="ì–‘í˜¸">ì–‘í˜¸</option>
                        <option value="ë³´í†µ">ë³´í†µ</option>
                        <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
                        <option value="ê³ ì¥">ê³ ì¥</option>
                    </select>
                    <button class="btn" onclick="printTable()">ì¸ì‡„</button>
                </div>

                <!-- ë¹„í’ˆ í…Œì´ë¸” -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ìˆœë²ˆ</th>
                                <th>ë¹„í’ˆë²ˆí˜¸</th>
                                <th>ë¶„ë¥˜</th>
                                <th>í’ˆëª©ëª…</th>
                                <th>ëª¨ë¸/ê·œê²©</th>
                                <th>ìˆ˜ëŸ‰</th>
                                <th>êµ¬ì…ì¼ì</th>
                                <th>êµ¬ì…ê°€ê²©</th>
                                <th>ì‚¬ìš©ë¶€ì„œ</th>
                                <th>ì‚¬ìš©ì</th>
                                <th>ìœ„ì¹˜</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="equipmentTableBody">
                            <tr>
                                <td colspan="13" class="empty-state">
                                    ë“±ë¡ëœ ë¹„í’ˆì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ë¹„í’ˆì„ ë“±ë¡í•´ì£¼ì„¸ìš”.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ëŒ€ì—¬ ê´€ë¦¬ -->
        <div class="section">
            <div class="section-header">
                <h2>â–  ëŒ€ì—¬ ë° ë°˜ë‚© ê´€ë¦¬</h2>
                <button class="btn btn-success" onclick="openModal('rentalModal')">
                    ï¼‹ ìƒˆ ëŒ€ì—¬ ë“±ë¡
                </button>
            </div>
            <div class="section-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ìˆœë²ˆ</th>
                                <th>ëŒ€ì—¬ë²ˆí˜¸</th>
                                <th>ë¹„í’ˆë²ˆí˜¸</th>
                                <th>í’ˆëª©ëª…</th>
                                <th>ëŒ€ì—¬ì</th>
                                <th>ë¶€ì„œ</th>
                                <th>ëŒ€ì—¬ì¼ì</th>
                                <th>ë°˜ë‚©ì˜ˆì •ì¼</th>
                                <th>ì‹¤ì œë°˜ë‚©ì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="rentalTableBody">
                            <tr>
                                <td colspan="11" class="empty-state">
                                    ë“±ë¡ëœ ëŒ€ì—¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° ë°±ì—…/ë³µì› -->
        <div class="data-management-2col">
            <div class="left">
                <h4>ğŸ“ ë°ì´í„° ê´€ë¦¬</h4>
                <div class="backup-btns-um">
                    <button class="btn" onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button>
                    <button class="btn" onclick="document.getElementById('importFile').click()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ì „ì²´ ë°ì´í„° ì‚­ì œ</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>

            <div class="right">
                <h4>â• ìƒˆ ë¶„ë¥˜ ì¶”ê°€</h4>
                <div class="category-adder">
                    <input type="text" id="newCategory" placeholder="ì˜ˆ: ë„¤íŠ¸ì›Œí¬ì¥ë¹„">
                    <button class="btn btn-sm" onclick="addCategory()">ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¹„í’ˆ ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="equipmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="equipmentModalTitle">ìƒˆ ë¹„í’ˆ ë“±ë¡</h3>
                <button class="close" onclick="closeModal('equipmentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="equipmentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="equipmentCode">ë¹„í’ˆë²ˆí˜¸ *</label>
                            <input type="text" id="equipmentCode" required>
                        </div>
                        <div class="form-group">
                            <label for="category">ë¶„ë¥˜ *</label>
                            <select id="category" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
                                <option value="ì‚¬ë¬´ê¸°ê¸°">ì‚¬ë¬´ê¸°ê¸°</option>
                                <option value="ê°€êµ¬">ê°€êµ¬</option>
                                <option value="ì†Œëª¨í’ˆ">ì†Œëª¨í’ˆ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemName">í’ˆëª©ëª… *</label>
                            <input type="text" id="itemName" required>
                        </div>
                        <div class="form-group">
                            <label for="model">ëª¨ë¸/ê·œê²©</label>
                            <input type="text" id="model">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity">ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="quantity" min="1" value="1" required>
                        </div>
                        <div class="form-group">
                            <label for="purchaseDate">êµ¬ì…ì¼ì *</label>
                            <input type="date" id="purchaseDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">êµ¬ì…ê°€ê²© (ì›)</label>
                            <input type="number" id="price" min="0">
                        </div>
                        <div class="form-group">
                            <label for="supplier">ê³µê¸‰ì—…ì²´</label>
                            <input type="text" id="supplier">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="department">ì‚¬ìš©ë¶€ì„œ</label>
                            <input type="text" id="department">
                        </div>
                        <div class="form-group">
                            <label for="user">ì‚¬ìš©ì</label>
                            <input type="text" id="user">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="location">ìœ„ì¹˜</label>
                            <input type="text" id="location">
                        </div>
                        <div class="form-group">
                            <label for="status">ìƒíƒœ *</label>
                            <select id="status" required>
                                <option value="ì–‘í˜¸">ì–‘í˜¸</option>
                                <option value="ë³´í†µ">ë³´í†µ</option>
                                <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
                                <option value="ê³ ì¥">ê³ ì¥</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">ë¹„ê³ </label>
                        <textarea id="notes" rows="3"></textarea>
                    </div>
                    <div style="text-align: right; margin-top: 20px; border-top: 1px solid #bdc3c7; padding-top: 15px;">
                        <button type="button" class="btn" onclick="closeModal('equipmentModal')">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-success">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì—¬ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="rentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ìƒˆ ëŒ€ì—¬ ë“±ë¡</h3>
                <button class="close" onclick="closeModal('rentalModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="rentalForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rentalCode">ëŒ€ì—¬ë²ˆí˜¸ *</label>
                            <input type="text" id="rentalCode" required>
                        </div>
                        <div class="form-group">
                            <label for="rentalEquipmentCode">ë¹„í’ˆë²ˆí˜¸ *</label>
                            <select id="rentalEquipmentCode" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="borrower">ëŒ€ì—¬ì *</label>
                            <input type="text" id="borrower" required>
                        </div>
                        <div class="form-group">
                            <label for="borrowerDept">ë¶€ì„œ *</label>
                            <input type="text" id="borrowerDept" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rentalDate">ëŒ€ì—¬ì¼ì *</label>
                            <input type="date" id="rentalDate" required>
                        </div>
                        <div class="form-group">
                            <label for="returnDate">ë°˜ë‚©ì˜ˆì •ì¼ *</label>
                            <input type="date" id="returnDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="rentalPurpose">ëŒ€ì—¬ì‚¬ìœ </label>
                        <textarea id="rentalPurpose" rows="3"></textarea>
                    </div>
                    <div style="text-align: right; margin-top: 20px; border-top: 1px solid #bdc3c7; padding-top: 15px;">
                        <button type="button" class="btn" onclick="closeModal('rentalModal')">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-success">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://pwvjjsweeazvzviknahe.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3dmpqc3dlZWF6dnp2aWtuYWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2NTIxNzMsImV4cCI6MjA2ODIyODE3M30.GgtLKFeEg61xmC_Jrmf-qfbUNK5eVC82EO8chJJcIQc';
        
        // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ì „ì—­ ë³€ìˆ˜
        let equipmentData = [];
        let rentalData = [];
        let editingEquipmentId = null;
        let categoryList = ["ì „ìê¸°ê¸°", "ì‚¬ë¬´ê¸°ê¸°", "ê°€êµ¬", "ì†Œëª¨í’ˆ"];

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            await loadDataFromSupabase();
            updateStats();
            renderEquipmentTable();
            renderRentalTable();
            setCurrentDate();
            renderCategoryOptions();
        });

        function renderCategoryOptions() {
            const select = document.getElementById('category');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            categoryList.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });

            // í•„í„°ì—ë„ ì ìš©
            const filter = document.getElementById('categoryFilter');
            if (filter) {
                filter.innerHTML = '<option value="">ì „ì²´ ë¶„ë¥˜</option>';
                categoryList.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    filter.appendChild(option);
                });
            }
        }

        // í˜„ì¬ ë‚ ì§œ ì„¤ì •
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.getFullYear() + 'ë…„ ' + 
                                 String(today.getMonth() + 1).padStart(2, '0') + 'ì›” ' + 
                                 String(today.getDate()).padStart(2, '0') + 'ì¼';
        }

        // Supabaseì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadDataFromSupabase() {
            try {
                // ë¹„í’ˆ ë°ì´í„° ë¡œë“œ
                const { data: equipment, error: equipmentError } = await supabaseClient
                    .from('equipment')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (equipmentError) throw equipmentError;
                equipmentData = equipment || [];

                // ëŒ€ì—¬ ë°ì´í„° ë¡œë“œ
                const { data: rentals, error: rentalError } = await supabaseClient
                    .from('rentals')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (rentalError) throw rentalError;
                rentalData = rentals || [];

                // ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ
                const { data: categories, error: categoryError } = await supabaseClient
                    .from('categories')
                    .select('*')
                    .order('created_at', { ascending: true });
                
                if (categoryError) throw categoryError;
                
                if (categories && categories.length > 0) {
                    categoryList = categories.map(cat => cat.name);
                }

                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', { equipment: equipmentData.length, rentals: rentalData.length, categories: categoryList.length });
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                
                // ì˜¤ë¥˜ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
                loadDataFromLocalStorage();
            }
        }

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ (ë°±ì—…ìš©)
        function loadDataFromLocalStorage() {
            const savedEquipment = localStorage.getItem('equipmentData');
            const savedRentals = localStorage.getItem('rentalData');
            const savedCategories = localStorage.getItem('categoryList');

            if (savedEquipment) {
                equipmentData = JSON.parse(savedEquipment);
            }
            if (savedRentals) {
                rentalData = JSON.parse(savedRentals);
            }
            if (savedCategories) {
                categoryList = JSON.parse(savedCategories);
            }

            renderCategoryOptions();
        }

        // ë¹„í’ˆ ì €ì¥/ì—…ë°ì´íŠ¸
        async function saveEquipment(equipmentItem, isUpdate = false, originalId = null) {
            try {
                if (isUpdate && originalId) {
                    const { error } = await supabaseClient
                        .from('equipment')
                        .update(equipmentItem)
                        .eq('id', originalId);
                    
                    if (error) throw error;
                } else {
                    const { error } = await supabaseClient
                        .from('equipment')
                        .insert([equipmentItem]);
                    
                    if (error) throw error;
                }
                
                await loadDataFromSupabase();
                return true;
            } catch (error) {
                console.error('ë¹„í’ˆ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ë¹„í’ˆ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return false;
            }
        }

        // ëŒ€ì—¬ ì €ì¥
        async function saveRental(rentalItem) {
            try {
                const { error } = await supabaseClient
                    .from('rentals')
                    .insert([rentalItem]);
                
                if (error) throw error;
                
                await loadDataFromSupabase();
                return true;
            } catch (error) {
                console.error('ëŒ€ì—¬ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ëŒ€ì—¬ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return false;
            }
        }

        // ë¶„ë¥˜ ì €ì¥
        async function saveCategory(categoryName) {
            try {
                const { error } = await supabaseClient
                    .from('categories')
                    .insert([{ name: categoryName }]);
                
                if (error) throw error;
                
                await loadDataFromSupabase();
                return true;
            } catch (error) {
                console.error('ë¶„ë¥˜ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ë¶„ë¥˜ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return false;
            }
        }

        // ë¹„í’ˆ í…Œì´ë¸” ë Œë”ë§
        function renderEquipmentTable() {
            const tbody = document.getElementById('equipmentTableBody');
            
            if (equipmentData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="13" class="empty-state">ë“±ë¡ëœ ë¹„í’ˆì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ë¹„í’ˆì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</td></tr>';
                return;
            }

            tbody.innerHTML = equipmentData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.equipment_code}</td>
                    <td>${item.category}</td>
                    <td>${item.item_name}</td>
                    <td>${item.model || '-'}</td>
                    <td>${item.quantity}</td>
                    <td>${item.purchase_date}</td>
                    <td>${item.price ? item.price.toLocaleString() + 'ì›' : '-'}</td>
                    <td>${item.department || '-'}</td>
                    <td>${item.user || '-'}</td>
                    <td>${item.location || '-'}</td>
                    <td><span class="status-${getStatusClass(item.status)}">${item.status}</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-sm" onclick="editEquipment(${index})">ìˆ˜ì •</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEquipment(${index})">ì‚­ì œ</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ëŒ€ì—¬ í…Œì´ë¸” ë Œë”ë§
        function renderRentalTable() {
            const tbody = document.getElementById('rentalTableBody');
            
            if (rentalData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" class="empty-state">ë“±ë¡ëœ ëŒ€ì—¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = rentalData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.rental_code}</td>
                    <td>${item.equipment_code}</td>
                    <td>${getEquipmentName(item.equipment_code)}</td>
                    <td>${item.borrower}</td>
                    <td>${item.department}</td>
                    <td>${item.rental_date}</td>
                    <td>${item.return_date}</td>
                    <td>${item.actual_return_date || '-'}</td>
                    <td>${item.actual_return_date ? 'ë°˜ë‚©ì™„ë£Œ' : 'ëŒ€ì—¬ì¤‘'}</td>
                    <td>
                        <div class="action-btns">
                            ${!item.actual_return_date ? `<button class="btn btn-sm btn-success" onclick="returnEquipment(${index})">ë°˜ë‚©</button>` : ''}
                            <button class="btn btn-sm btn-danger" onclick="deleteRental(${index})">ì‚­ì œ</button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            updateRentalSelect();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const total = equipmentData.length;
            const good = equipmentData.filter(item => item.status === 'ì–‘í˜¸').length;
            const needMaintenance = equipmentData.filter(item => item.status === 'ë³´í†µ' || item.status === 'ë¶ˆëŸ‰').length;
            const totalValue = Math.round(equipmentData.reduce((sum, item) => sum + (item.price || 0), 0) / 10000);

            document.getElementById('totalEquipment').textContent = total;
            document.getElementById('goodCondition').textContent = good;
            document.getElementById('needMaintenance').textContent = needMaintenance;
            document.getElementById('totalValue').textContent = totalValue.toLocaleString();
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getStatusClass(status) {
            switch(status) {
                case 'ì–‘í˜¸': return 'good';
                case 'ë³´í†µ': return 'fair';
                case 'ë¶ˆëŸ‰': return 'poor';
                case 'ê³ ì¥': return 'poor';
                default: return 'good';
            }
        }

        function getEquipmentName(equipmentCode) {
            const equipment = equipmentData.find(item => item.equipment_code === equipmentCode);
            return equipment ? equipment.item_name : 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        function generateEquipmentCode() {
            const lastNumber = equipmentData.length > 0 ? 
                Math.max(...equipmentData.map(item => {
                    const match = item.equipment_code.match(/EQ-(\d+)/);
                    return match ? parseInt(match[1]) : 0;
                })) : 0;
            return `EQ-${String(lastNumber + 1).padStart(3, '0')}`;
        }

        function generateRentalCode() {
            const lastNumber = rentalData.length > 0 ? 
                Math.max(...rentalData.map(item => {
                    const match = item.rental_code.match(/R-(\d+)/);
                    return match ? parseInt(match[1]) : 0;
                })) : 0;
            return `R-${String(lastNumber + 1).padStart(3, '0')}`;
        }

        // ë¹„í’ˆ ë“±ë¡/ìˆ˜ì • í¼ ì²˜ë¦¬
        document.getElementById('equipmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                equipment_code: document.getElementById('equipmentCode').value,
                category: document.getElementById('category').value,
                item_name: document.getElementById('itemName').value,
                model: document.getElementById('model').value,
                quantity: parseInt(document.getElementById('quantity').value),
                purchase_date: document.getElementById('purchaseDate').value,
                price: parseInt(document.getElementById('price').value) || 0,
                supplier: document.getElementById('supplier').value,
                department: document.getElementById('department').value,
                user: document.getElementById('user').value,
                location: document.getElementById('location').value,
                status: document.getElementById('status').value,
                notes: document.getElementById('notes').value
            };

            let success = false;
            if (editingEquipmentId !== null) {
                // ìˆ˜ì •
                const originalItem = equipmentData[editingEquipmentId];
                success = await saveEquipment(formData, true, originalItem.id);
                if (success) {
                    alert('ë¹„í’ˆ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } else {
                // ì‹ ê·œ ë“±ë¡
                success = await saveEquipment(formData, false);
                if (success) {
                    alert('ìƒˆ ë¹„í’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
            
            if (success) {
                renderEquipmentTable();
                updateStats();
                closeModal('equipmentModal');
                resetEquipmentForm();
            }
        });

        // ëŒ€ì—¬ ë“±ë¡ í¼ ì²˜ë¦¬
        document.getElementById('rentalForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                rental_code: document.getElementById('rentalCode').value,
                equipment_code: document.getElementById('rentalEquipmentCode').value,
                borrower: document.getElementById('borrower').value,
                department: document.getElementById('borrowerDept').value,
                rental_date: document.getElementById('rentalDate').value,
                return_date: document.getElementById('returnDate').value,
                purpose: document.getElementById('rentalPurpose').value,
                actual_return_date: null
            };

            const success = await saveRental(formData);
            if (success) {
                renderRentalTable();
                closeModal('rentalModal');
                resetRentalForm();
                alert('ëŒ€ì—¬ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ëª¨ë‹¬ ê´€ë¦¬
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            if (modalId === 'equipmentModal') {
                if (editingEquipmentId === null) {
                    document.getElementById('equipmentCode').value = generateEquipmentCode();
                }
            }
            
            if (modalId === 'rentalModal') {
                document.getElementById('rentalCode').value = generateRentalCode();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('rentalDate').value = today;
                updateRentalSelect();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            editingEquipmentId = null;
        }

        // í¼ ë¦¬ì…‹
        function resetEquipmentForm() {
            document.getElementById('equipmentForm').reset();
            document.getElementById('equipmentModalTitle').textContent = 'ìƒˆ ë¹„í’ˆ ë“±ë¡';
            editingEquipmentId = null;
        }

        function resetRentalForm() {
            document.getElementById('rentalForm').reset();
        }

        // ëŒ€ì—¬ ê°€ëŠ¥ ë¹„í’ˆ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateRentalSelect() {
            const select = document.getElementById('rentalEquipmentCode');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            
            // ëŒ€ì—¬ ì¤‘ì´ ì•„ë‹Œ ë¹„í’ˆë§Œ í‘œì‹œ
            const availableEquipment = equipmentData.filter(equipment => {
                const isRented = rentalData.some(rental => 
                    rental.equipment_code === equipment.equipment_code && !rental.actual_return_date
                );
                return !isRented && equipment.status === 'ì–‘í˜¸';
            });

            availableEquipment.forEach(equipment => {
                const option = document.createElement('option');
                option.value = equipment.equipment_code;
                option.textContent = `${equipment.equipment_code} - ${equipment.item_name}`;
                select.appendChild(option);
            });
        }

        // ë¹„í’ˆ ìˆ˜ì •
        function editEquipment(index) {
            const equipment = equipmentData[index];
            if (!equipment) return;

            editingEquipmentId = index;
            document.getElementById('equipmentModalTitle').textContent = 'ë¹„í’ˆ ì •ë³´ ìˆ˜ì •';
            
            // í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('equipmentCode').value = equipment.equipment_code;
            document.getElementById('category').value = equipment.category;
            document.getElementById('itemName').value = equipment.item_name;
            document.getElementById('model').value = equipment.model || '';
            document.getElementById('quantity').value = equipment.quantity;
            document.getElementById('purchaseDate').value = equipment.purchase_date;
            document.getElementById('price').value = equipment.price || '';
            document.getElementById('supplier').value = equipment.supplier || '';
            document.getElementById('department').value = equipment.department || '';
            document.getElementById('user').value = equipment.user || '';
            document.getElementById('location').value = equipment.location || '';
            document.getElementById('status').value = equipment.status;
            document.getElementById('notes').value = equipment.notes || '';

            openModal('equipmentModal');
        }

        // ë¹„í’ˆ ì‚­ì œ
        async function deleteEquipment(index) {
            if (!confirm('ì´ ë¹„í’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const equipment = equipmentData[index];
                const { error } = await supabaseClient
                    .from('equipment')
                    .delete()
                    .eq('id', equipment.id);
                
                if (error) throw error;
                
                await loadDataFromSupabase();
                renderEquipmentTable();
                updateStats();
                alert('ë¹„í’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('ë¹„í’ˆ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ë¹„í’ˆ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ëŒ€ì—¬ ë°˜ë‚©
        async function returnEquipment(index) {
            if (!confirm('ì´ ë¹„í’ˆì„ ë°˜ë‚© ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const rental = rentalData[index];
                const today = new Date().toISOString().split('T')[0];
                
                const { error } = await supabaseClient
                    .from('rentals')
                    .update({ actual_return_date: today })
                    .eq('id', rental.id);
                
                if (error) throw error;
                
                await loadDataFromSupabase();
                renderRentalTable();
                alert('ë°˜ë‚© ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('ë°˜ë‚© ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ë°˜ë‚© ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ëŒ€ì—¬ ì‚­ì œ
        async function deleteRental(index) {
            if (!confirm('ì´ ëŒ€ì—¬ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const rental = rentalData[index];
                const { error } = await supabaseClient
                    .from('rentals')
                    .delete()
                    .eq('id', rental.id);
                
                if (error) throw error;
                
                await loadDataFromSupabase();
                renderRentalTable();
                alert('ëŒ€ì—¬ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('ëŒ€ì—¬ ê¸°ë¡ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ëŒ€ì—¬ ê¸°ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ê²€ìƒ‰ ë° í•„í„°
        function filterEquipment() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            const filteredData = equipmentData.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.item_name.toLowerCase().includes(searchTerm) ||
                    (item.model && item.model.toLowerCase().includes(searchTerm)) ||
                    item.equipment_code.toLowerCase().includes(searchTerm);
                
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const matchesStatus = !statusFilter || item.status === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            // í•„í„°ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë Œë”ë§
            const tbody = document.getElementById('equipmentTableBody');
            
            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="13" class="empty-state">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = filteredData.map((item, originalIndex) => {
                const index = equipmentData.indexOf(item);
                return `
                    <tr>
                        <td>${originalIndex + 1}</td>
                        <td>${item.equipment_code}</td>
                        <td>${item.category}</td>
                        <td>${item.item_name}</td>
                        <td>${item.model || '-'}</td>
                        <td>${item.quantity}</td>
                        <td>${item.purchase_date}</td>
                        <td>${item.price ? item.price.toLocaleString() + 'ì›' : '-'}</td>
                        <td>${item.department || '-'}</td>
                        <td>${item.user || '-'}</td>
                        <td>${item.location || '-'}</td>
                        <td><span class="status-${getStatusClass(item.status)}">${item.status}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm" onclick="editEquipment(${index})">ìˆ˜ì •</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteEquipment(${index})">ì‚­ì œ</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)
        async function exportData() {
            try {
                await loadDataFromSupabase(); // ìµœì‹  ë°ì´í„° ë¡œë“œ
                
                const data = {
                    equipment: equipmentData,
                    rentals: rentalData,
                    categories: categoryList, 
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});

                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ë¹„í’ˆê´€ë¦¬_ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            } catch (error) {
                console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (JSON)
        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (data.equipment && data.rentals) {
                        if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ ë°ì´í„°ë¡œ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (Supabaseì— ì €ì¥ë©ë‹ˆë‹¤)')) {
                            
                            // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
                            await supabaseClient.from('equipment').delete().neq('id', 0);
                            await supabaseClient.from('rentals').delete().neq('id', 0);
                            await supabaseClient.from('categories').delete().neq('id', 0);
                            
                            // ìƒˆ ë°ì´í„° ì‚½ì…
                            if (data.equipment.length > 0) {
                                const equipmentToInsert = data.equipment.map(item => ({
                                    equipment_code: item.equipment_code || item.equipmentCode,
                                    category: item.category,
                                    item_name: item.item_name || item.itemName,
                                    model: item.model,
                                    quantity: item.quantity,
                                    purchase_date: item.purchase_date || item.purchaseDate,
                                    price: item.price,
                                    supplier: item.supplier,
                                    department: item.department,
                                    user: item.user,
                                    location: item.location,
                                    status: item.status,
                                    notes: item.notes
                                }));
                                await supabaseClient.from('equipment').insert(equipmentToInsert);
                            }
                            
                            if (data.rentals.length > 0) {
                                const rentalsToInsert = data.rentals.map(item => ({
                                    rental_code: item.rental_code || item.rentalCode,
                                    equipment_code: item.equipment_code || item.equipmentCode,
                                    borrower: item.borrower,
                                    department: item.department,
                                    rental_date: item.rental_date || item.rentalDate,
                                    return_date: item.return_date || item.returnDate,
                                    purpose: item.purpose,
                                    actual_return_date: item.actual_return_date || item.actualReturnDate
                                }));
                                await supabaseClient.from('rentals').insert(rentalsToInsert);
                            }
                            
                            if (data.categories && data.categories.length > 0) {
                                const categoriesToInsert = data.categories.map(name => ({ name }));
                                await supabaseClient.from('categories').insert(categoriesToInsert);
                            }

                            await loadDataFromSupabase();
                            renderEquipmentTable();
                            renderRentalTable();
                            updateStats();
                            alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                        }
                    } else {
                        alert('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ì „ì²´ ë°ì´í„° ì‚­ì œ
        async function clearAllData() {
            if (!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë¹„í’ˆ ë° ëŒ€ì—¬ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await supabaseClient.from('equipment').delete().neq('id', 0);
                await supabaseClient.from('rentals').delete().neq('id', 0);
                
                equipmentData = [];
                rentalData = [];
                
                renderEquipmentTable();
                renderRentalTable();
                updateStats();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¸ì‡„ ê¸°ëŠ¥
        function printTable() {
            window.print();
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        async function addCategory() {
            const input = document.getElementById('newCategory');
            const newCat = input.value.trim();
            if (!newCat) return alert("ë¶„ë¥˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if (categoryList.includes(newCat)) return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¶„ë¥˜ì…ë‹ˆë‹¤.");

            const success = await saveCategory(newCat);
            if (success) {
                renderCategoryOptions();
                input.value = '';
                alert("ìƒˆ ë¶„ë¥˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>
</html>